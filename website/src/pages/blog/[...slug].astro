---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    .filter((p) => !p.data.draft)
    .map((post) => ({
      params: { slug: post.id },
      props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <article class="max-w-3xl mx-auto px-6 py-12">
    <header class="mb-8">
      <div class="mb-4">
        <a href="/blog" class="text-green-400 hover:text-green-300 text-sm transition">
          &larr; Back to Blog
        </a>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold mb-4 leading-tight">
        {post.data.title}
      </h1>
      <p class="text-xl text-gray-400 mb-4">{post.data.description}</p>
      <time datetime={post.data.pubDate.toISOString()} class="text-gray-500 text-sm">
        {post.data.pubDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        })}
      </time>
    </header>

    <hr class="border-gray-800 mb-8" />

    <div class="prose prose-invert prose-lg max-w-none
                prose-headings:font-semibold prose-headings:text-gray-100
                prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4
                prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3
                prose-p:text-gray-300 prose-p:leading-relaxed
                prose-a:text-green-400 prose-a:no-underline hover:prose-a:underline
                prose-strong:text-white
                prose-code:bg-[#161b22] prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:text-gray-300
                prose-pre:bg-[#161b22] prose-pre:border prose-pre:border-gray-800 prose-pre:rounded-lg
                prose-blockquote:border-l-green-400 prose-blockquote:text-gray-400 prose-blockquote:italic
                prose-ul:text-gray-300 prose-ol:text-gray-300
                prose-li:marker:text-gray-500
                prose-hr:border-gray-800">
      <Content />
    </div>

    <footer class="mt-12 pt-8 border-t border-gray-800">
      <div class="bg-[#161b22] rounded-lg border border-gray-800 p-6">
        <h3 class="font-semibold mb-2">Want to try Casparian Flow?</h3>
        <p class="text-gray-400 text-sm mb-4">
          Turn your file corpuses into governed, queryable tables with lineage on every row.
        </p>
        <a href="/" class="inline-block px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium transition">
          Learn More
        </a>
      </div>
    </footer>
  </article>
</BaseLayout>
